/**
 * Project Name :- Mineboty
 * Author :- JustaKartik
 * © Copyright 2021-2023 Mineboty
 * Powered By Team Ic
 * Partnered By RudraCloud.com
 */

const fs = require('fs')
const path = require('path')
const mineflayer = require('mineflayer')
const armorManager = require("mineflayer-armor-manager");
const autoeat = require('mineflayer-auto-eat').plugin
const rawdata = fs.readFileSync('config.json');
let data = JSON.parse(rawdata);
// Details
const host = data["ip"];
const port = data["port"]
const password = data["password"]
const username = data["username"];
const loginmsg = data["loginmsg"]


const auth = {
    host: 'in-1.rudracloud.com' || host,
    port: 1510 || port, // Mineraft server port
    username: 'Mineboty' || username,
    password: password,
}

function injectModules (bot) {
  const MODULES_DIRECTORY = path.join(__dirname, 'modules')
  const modules = fs
    .readdirSync(MODULES_DIRECTORY) // find the plugins
    .filter(x => x.endsWith('.js')) // only use .js files
    .map(pluginName => require(path.join(MODULES_DIRECTORY, pluginName)))

  bot.loadPlugins(modules)
}


function initBot () {
  const login = loginmsg
  const bot = mineflayer.createBot(auth)
  injectModules(bot)
  bot.on('login', function() {
    console.log("checking login system")
    console.log("Please wait ..")
    console.log("Logged In Successfully 👍🏻")
    bot.chat(`/register ${login} ${login}`);
    bot.chat(`/login ${login} ${login}`)
    bot.chat("uhk")
});
bot.once('spawn', () => {
  bot.autoEat.options.priority = 'foodPoints'
  bot.autoEat.options.startAt = 14
  bot.autoEat.options.bannedFood.push('golden_apple')
})
  bot.loadPlugin(autoeat)
  bot.loadPlugin(armorManager);
  bot.on('autoeat_started', (item, offhand) => {
    console.log(`Eating ${item.name} in ${offhand ? 'offhand' : 'hand'}`)
})

bot.on('autoeat_finished', (item, offhand) => {
    console.log(`Finished eating ${item.name} in ${offhand ? 'offhand' : 'hand'}`)
})

bot.on('autoeat_error', console.error)
  bot.on('end', initBot) // auto restart
}

initBot() // start the bot